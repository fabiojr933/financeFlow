generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////////////
// ENUMS
//////////////////////////////////////

enum PlanType {
  FREE
  GOLD
}

//////////////////////////////////////
// MODELS
//////////////////////////////////////


model User {
  id        String   @id @default(uuid())
  name      String   @db.VarChar(100)
  email     String   @unique @db.VarChar(150)
  address   String   @db.VarChar(255)
  password  String   @db.VarChar(100)

  planId    String
  plan      Plan     @relation(fields: [planId], references: [id])
  expiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  transactions  Transaction[]
  categories    Category[]
  creditCards   CreditCard[]
  bankAccounts  BankAccount[]
  invoices      InvoiceCreditCard[]
}

model Plan {
  id     String   @id @default(uuid())
  type   PlanType @unique
  amount Float

  users User[]
}

model Category {
  id     String @id @default(uuid())
  userId String

  name  String @db.VarChar(100)
  icon  String @db.VarChar(50)
  color String @db.VarChar(20)
  type  String @db.VarChar(20) // income | expense

  user     User                @relation(fields: [userId], references: [id])
  invoices InvoiceCreditCard[] // ðŸ‘ˆ RELAÃ‡ÃƒO INVERSA
}


model CreditCard {
  id     String @id @default(uuid())
  userId String

  name        String
  closingDate Int
  limit       Float

  user     User                  @relation(fields: [userId], references: [id])
  invoices InvoiceCreditCard[]
}

model BankAccount {
  id     String @id @default(uuid())
  userId String

  name    String
  type    String
  balance Float
  icon    String

  user         User          @relation(fields: [userId], references: [id])
  transactions Transaction[]
}

model Transaction {
  id            String   @id @default(uuid())
  userId        String
  bankAccountId String?

  description String   @db.VarChar(100)
  date        DateTime @default(now())
  value       Float
  status      String   @db.VarChar(20)
  type        String   @db.VarChar(25)

  user        User         @relation(fields: [userId], references: [id])
  bankAccount BankAccount? @relation(fields: [bankAccountId], references: [id])
}

model InvoiceCreditCard {
  id           String   @id @default(uuid())
  userId       String
  creditCardId String
  categoryId   String?

  amount  Float
  status  String   @db.VarChar(20) // pending | paid | canceled
  dueDate DateTime
  paidAt  DateTime?

  createdAt DateTime @default(now())

  user        User        @relation(fields: [userId], references: [id])
  creditCard CreditCard  @relation(fields: [creditCardId], references: [id])
  category   Category?   @relation(fields: [categoryId], references: [id])
}
